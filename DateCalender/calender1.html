<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>calender</title>
    <style>
        body {
            background-color: rgb(44, 43, 43);
        }

        .event {
            border: 1px solid black;
        }

        #weekContainer {
            display: flex;
            text-align: center;
            justify-content: space-evenly;
        }
    </style>
</head>

<body>

    <button id="reduceWeek">
        left
    </button>
    <!-- <h1>Martins Kalender</h1> -->
    <button id="incrementWeek">
        right
    </button>
    <div id="weekContainer">

        <!-- Id change to jsondataobject -->
        <div id="mandag">
            <h2>Måndag</h2>
            <div class="domDayObjects"></div>
        </div>
        <div id="tisdag">
            <h2>Tisdag</h2>
            <div class="domDayObjects"></div>
        </div>
        <div id="onsdag">
            <h2>Onsdag</h2>
            <div class="domDayObjects"></div>
        </div>
        <div id="torsdag">
            <h2>Torsdag</h2>
            <div class="domDayObjects"></div>
        </div>
        <div id="fredag">
            <h2>Fredag</h2>
            <div class="domDayObjects"></div>
        </div>
        <div id="lordag">
            <h2>Lördag</h2>
            <div class="domDayObjects"></div>
        </div>
        <div id="sondag">
            <h2>Söndag</h2>
            <div class="domDayObjects"></div>
        </div>

    </div>


    <script>
        //Global vars

        const domDayObjects = document.querySelectorAll('.domDayObjects');
        const reduceWeek = document.getElementById("reduceWeek");
        const incrementWeek = document.getElementById("incrementWeek");

        let unalteredDate = new Date();
        let date = new Date();

        // Debugging
        // date.setDate(date.getDate() + 3)
        // unalteredDate.setDate(unalteredDate.getDate() + 4)


        let jsonApiEvents;

        window.onload = getData();

        // Fetch Data

        function getData() {
            fetch("./../data/dataEvents.json")
                .then(resp => resp.json())
                .then(data => {
                    jsonApiEvents = data;
                    calculateCurrentDay()
                }).catch((error) => {
                    console.error('Error:', error);
                });
        };

        // functions for manipulating and appending dom.

        function setDomDataObject(domDataObject, a) {
            date.setDate(date.getDate() + a);
                domDataObject.dataset.date = date.toLocaleString("sv-SE").slice(0, 10);
                // console.log(domJsonObjectChildren.dataset.date);
        }

        function markCurrentDay(domDataObject) {
         //Mark current local date
         if (date.getTime() === unalteredDate.getTime()) {
                    domDataObject.style.backgroundColor = "green"
                } else {
                    domDataObject.style.backgroundColor = "transparent"
                }
            }

        function cleanDomEvents(domDataObject) {
            domDataObject.innerHTML = `<div>${date.toLocaleString("sv-SE").slice(5, 10)}</div>`;
            return;
        }
       
        function alterDomData() {
            let a;
            a = 0;
            for (let domDataObject of domDayObjects) {
              setDomDataObject(domDataObject, a) 
                cleanDomEvents(domDataObject)
                markCurrentDay(domDataObject)
                a = 1;
            }
            date.setDate(date.getDate() - 6);
            return;
        }

        function appendDomData() {
            for (let domObject of domDayObjects) {
                let jsonDateEvents = jsonApiEvents.filter(event => event.date === domObject.dataset.date)
                // console.log(jsonDateEvents);



                for (jsonDateEvent of jsonDateEvents) {
                    let newDiv = document.createElement("div");
                    newDiv.classList.add("event");
                    newDiv.id = jsonDateEvent.id;
                    newDiv.innerHTML =
                        `<p>${jsonDateEvent.title}</p><p>Tid ${jsonDateEvent.starttime}-${jsonDateEvent.endtime}</p>`;
                    domObject.appendChild(newDiv);
                }
            }
            return
        }

        function modifyDomWeek() {
            alterDomData()
            appendDomData()
        }

        function calculateCurrentDay() {
            let validateDay = date.getDay();
            if (validateDay !== 1) {
                if (validateDay === 0) {
                    validateDay + 7;
                }
                date.setDate(date.getDate() - validateDay + 1);
            }
            modifyDomWeek()
        }



        //Events

        reduceWeek.addEventListener('click', () => {
            console.log("reduce");
            date.setDate(date.getDate() - 7);
            modifyDomWeek();
        })


        incrementWeek.addEventListener('click', () => {
            console.log("increment");
            date.setDate(date.getDate() + 7);
            modifyDomWeek();
        })
    </script>
</body>

</html>